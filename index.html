<!DOCTYPE html>
<html>

<head>
	<title>Duo-Pong</title>
	<meta name="author" content="Dmitrii Cucleschin / Nikolce Kolev">
	<meta description="A game of ping-pong, played on shared screen of two computers. Made as CS Club demo for Jacobs University Club Fair by Dmitrii Cucleschin and Nikolce Kolev.">
	<meta name="keywords" content="ping-pong, ping, pong, javascript, demo, dual, two-player, automatic, game">
	<style>
		body {padding: 0; margin: 0; overflow: hidden;}
	</style>
</head>

<body>
	<canvas id="canvas"></canvas>
</body>

<script type="text/javascript">
	// Sets screen animation to 60 fps to ensure smooth animations.
	window.requestAnimFrame = (function(){
		return  window.requestAnimationFrame 	|| 
			window.webkitRequestAnimationFrame 	|| 
			window.mozRequestAnimationFrame 	|| 
			window.oRequestAnimationFrame 		|| 
			window.msRequestAnimationFrame 		||  
			function( callback ){
				return window.setTimeout(callback, 1000 / 60);
			};
	})();

	// Stop animating when game has ended.
	window.cancelRequestAnimFrame = ( function() {
	return window.cancelAnimationFrame 				||
		window.webkitCancelRequestAnimationFrame 	||
		window.mozCancelRequestAnimationFrame 		||
		window.oCancelRequestAnimationFrame 		||
		window.msCancelRequestAnimationFrame 		||
		clearTimeout
	} )();

	// Initialize needed variables.
	var canvas = document.getElementById("canvas"),
		ctx = canvas.getContext("2d"),
		width = window.innerWidth,
		height = window.innerHeight,
		ball = {},
		paddle = {},
		mouse = {},
		my_score = 0,
		enemy_score = 0,
		fps = 60,
		init;

	// Make canvas equal to screen dimensions and set listeners.
	canvas.width = width;
	canvas.height = height;
	canvas.addEventListener("mousemove", mouseMoved, true);

	// Define properties of the ball.
	ball = {
		x: 50,
		y: 50,
		r: 15,
		color: "white",
		vx: 8,
		vy: 4,

		draw: function() {
			ctx.beginPath();
			ctx.fillStyle = this.color;
			ctx.arc(this.x, this.y, this.r, 0, Math.PI*2, false);
			ctx.fill();
		}
	};

	// Define properties of the paddle.
	paddle = new (function()
	{
		var offset = 20;

	  	this.h = 200;
		this.w = 20;
		this.pos = "right"; // Need to assign based on player type!
		this.x = (this.pos === "left") ? offset : (width - this.w - offset);
		this.y = height/2 - this.h/2;
		this.color = "white";

		this.draw = function() {
			ctx.fillStyle = this.color;
			ctx.fillRect(this.x,this.y,this.w,this.h);
		};  
	})();

	// Fills canvas' background.
	function paintCanvas() {
		ctx.fillStyle = "black";
		ctx.fillRect(0,0,width,height);
	}

	// Game logic.
	var cx = 1;
	var cy = 1;
	function update() {
		if (mouse.x && mouse.y) {
			paddle.y = mouse.y - paddle.h/2;

			// Or use following instead to limit to the screen height:
			//paddle.y = Math.min(Math.max(mouse.y - paddle.h/2,0),height-paddle.h);
		}

		if (ball.x > width || ball.x < 0)
			cx *= -1;

		if (ball.y > height || ball.y < 0)
			cy *= -1;

		ball.x += cx * ball.vx;
		ball.y += cy * ball.vx;

	}

	// Update current mouse coordinates.
	function mouseMoved(e) {
		mouse.x = e.pageX;
		mouse.y = e.pageY;
	}

	// Defines drawing of the single frame of the game.
	function draw() {
		paintCanvas();

		ball.draw();
		paddle.draw();

		update();
	}

	// Loop, that keeps repeating during the game to keep animation running.
	function animationLoop() {
		init = requestAnimFrame(animationLoop);
		draw();
	}

	// Action, that starts the game.
	function startGame() {
		animationLoop();
	}

	startGame();
</script>
</html>